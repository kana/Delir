module.exports=function(t){function e(r){if(o[r])return o[r].exports;var n=o[r]={i:r,l:!1,exports:{}};return t[r].call(n.exports,n,n.exports,e),n.l=!0,n.exports}var o={};return e.m=t,e.c=o,e.d=function(t,o,r){e.o(t,o)||Object.defineProperty(t,o,{configurable:!1,enumerable:!0,get:r})},e.n=function(t){var o=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(o,"a",o),o},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=13)}([function(t,e){t.exports=require("delir-core")},function(t,e,o){var r=o(8).Symbol;t.exports=r},function(t,e,o){var r=o(3),n=o(4);t.exports=function(t,e,o){return void 0===o&&(o=e,e=void 0),void 0!==o&&(o=(o=n(o))===o?o:0),void 0!==e&&(e=(e=n(e))===e?e:0),r(n(t),e,o)}},function(t,e){t.exports=function(t,e,o){return t===t&&(void 0!==o&&(t=t<=o?t:o),void 0!==e&&(t=t>=e?t:e)),t}},function(t,e,o){var r=o(5),n=o(6),i=NaN,a=/^\s+|\s+$/g,c=/^[-+]0x[0-9a-f]+$/i,s=/^0b[01]+$/i,l=/^0o[0-7]+$/i,u=parseInt;t.exports=function(t){if("number"==typeof t)return t;if(n(t))return i;if(r(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=r(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=t.replace(a,"");var o=s.test(t);return o||l.test(t)?u(t.slice(2),o?2:8):c.test(t)?i:+t}},function(t,e){t.exports=function(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}},function(t,e,o){var r=o(7),n=o(12),i="[object Symbol]";t.exports=function(t){return"symbol"==typeof t||n(t)&&r(t)==i}},function(t,e,o){var r=o(1),n=o(10),i=o(11),a="[object Null]",c="[object Undefined]",s=r?r.toStringTag:void 0;t.exports=function(t){return null==t?void 0===t?c:a:s&&s in Object(t)?n(t):i(t)}},function(t,e,o){var r=o(9),n="object"==typeof self&&self&&self.Object===Object&&self,i=r||n||Function("return this")();t.exports=i},function(t,e){var o="object"==typeof global&&global&&global.Object===Object&&global;t.exports=o},function(t,e,o){var r=o(1),n=Object.prototype,i=n.hasOwnProperty,a=n.toString,c=r?r.toStringTag:void 0;t.exports=function(t){var e=i.call(t,c),o=t[c];try{t[c]=void 0;var r=!0}catch(t){}var n=a.call(t);return r&&(e?t[c]=o:delete t[c]),n}},function(t,e){var o=Object.prototype.toString;t.exports=function(t){return o.call(t)}},function(t,e){t.exports=function(t){return null!=t&&"object"==typeof t}},function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=o(0),n=(o.n(r),o(2)),i=(o.n(n),this&&this.__awaiter||function(t,e,o,r){return new(o||(o=Promise))(function(n,i){function a(t){try{s(r.next(t))}catch(t){i(t)}}function c(t){try{s(r.throw(t))}catch(t){i(t)}}function s(t){t.done?n(t.value):new o(function(e){e(t.value)}).then(a,c)}s((r=r.apply(t,e||[])).next())})});class a extends r.PostEffectBase{constructor(){super(...arguments),this.attribs={},this.uni={}}static provideParameters(){return r.Type.float("threshold",{label:"Threshold",defaultValue:1,animatable:!0}).colorRgba("keyColor",{label:"Key color",defaultValue:new r.Values.ColorRGBA(0,0,0,1),animatable:!0})}initialize(t){return i(this,void 0,void 0,function*(){this.ctxBindToken=t.glContextPool.generateContextBindToken();const e=yield t.glContextPool.getContext("webgl");e.canvas;this.texCanvas=document.createElement("canvas"),this.texCanvasCtx=this.texCanvas.getContext("2d");const o=this.program=e.createProgram();e.enable(e.DEPTH_TEST);const r=this.vertShader=e.createShader(e.VERTEX_SHADER);e.shaderSource(r,a.VERTEX_SHADER),e.compileShader(r);const n=this.fragShader=e.createShader(e.FRAGMENT_SHADER);if(e.shaderSource(n,a.FRAGMENT_SHADER),e.compileShader(n),e.attachShader(o,r),e.attachShader(o,n),e.linkProgram(o),!e.getProgramParameter(o,e.LINK_STATUS)){const t=e.getProgramInfoLog(o);throw new Error(`[@ragg/delir-posteffect-chromakey] Failed to compile shader. (${t})`)}this.tex=e.createTexture(),this.uni.texture0=e.getUniformLocation(this.program,"texture0"),this.uni.keyColor=e.getUniformLocation(this.program,"keyColor"),this.uni.threshold=e.getUniformLocation(this.program,"threshold"),this.attribs.position=e.getAttribLocation(this.program,"position"),this.attribs.coord=e.getAttribLocation(this.program,"coord"),this.vertexBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),e.bufferData(e.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,1,1,-1,1]),e.STATIC_DRAW),this.tex2DBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.tex2DBuffer),e.bufferData(e.ARRAY_BUFFER,new Float32Array([0,1,1,1,1,0,0,0]),e.STATIC_DRAW),t.glContextPool.registerContextForToken(this.ctxBindToken,e),t.glContextPool.releaseContext(e)})}render(t){return i(this,void 0,void 0,function*(){const{srcCanvas:e,destCanvas:o,parameters:{threshold:r,keyColor:i}}=t,a=o.getContext("2d"),c=yield t.glContextPool.getContextByToken(this.ctxBindToken),s=c.canvas,l=this.texCanvas,u=this.texCanvasCtx;l.width=l.height=2**Math.ceil(Math.log2(Math.max(t.width,t.height))),u.clearRect(0,0,l.width,l.height),u.drawImage(e,0,0,l.width,l.width),c.useProgram(this.program),s.width=t.width,s.height=t.height,c.viewport(0,0,t.width,t.height),c.clearColor(0,0,0,0),c.clear(c.COLOR_BUFFER_BIT|c.DEPTH_BUFFER_BIT),c.bindBuffer(c.ARRAY_BUFFER,this.vertexBuffer),c.enableVertexAttribArray(this.attribs.position),c.vertexAttribPointer(this.attribs.position,2,c.FLOAT,!1,0,0),c.bindBuffer(c.ARRAY_BUFFER,this.tex2DBuffer),c.enableVertexAttribArray(this.attribs.coord),c.vertexAttribPointer(this.attribs.coord,2,c.FLOAT,!1,0,0),c.activeTexture(c.TEXTURE0),c.bindTexture(c.TEXTURE_2D,this.tex),c.texImage2D(c.TEXTURE_2D,0,c.RGBA,c.RGBA,c.UNSIGNED_BYTE,l),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,c.LINEAR),c.uniform1i(this.uni.texture0,0),c.uniform3f(this.uni.keyColor,i.r/255,i.g/255,i.b/255),c.uniform1f(this.uni.threshold,n(r,0,100)/100),c.drawArrays(c.TRIANGLE_FAN,0,4),c.flush(),a.clearRect(0,0,t.width,t.height),a.drawImage(s,0,0),t.glContextPool.releaseContext(c)})}}e.default=a,a.VERTEX_SHADER=o(14),a.FRAGMENT_SHADER=o(15)},function(t,e){t.exports="// #ifdef GL_ES\n// precision highp float;\n// #endif\n\n// attribute vec3 position;\n// attribute vec2 texCoord;\n\n// varying vec2 vTexCoord;\n// varying vec4 vPosition;\n// varying vec2 vSourceCoord;\n// varying vec2 vAlphaCoord;\n\n// uniform vec4 sourceArea;\n// uniform vec4 alphaArea;\n\n// void main(void) {\n//     gl_Position = vec4(position, 1.0);\n//     vTexCoord = vec2(texCoord.s, texCoord.t);\n//     vSourceCoord = vec2(sourceArea.x + texCoord.s * sourceArea.z, sourceArea.y + texCoord.t * sourceArea.w);\n//     vAlphaCoord = vec2(alphaArea.x + texCoord.s * alphaArea.z, alphaArea.y + texCoord.t * alphaArea.w);\n// }\n\n\n\n// attribute vec3 position;\n// attribute vec2 coord;\n\n// varying vec2 texCoord;\n\n// void main(){\n//     texCoord = coord;\n//     gl_Position = vec4(position, 1.0);\n// }\n\n\n\nattribute vec2 position;\nattribute vec2 coord;\nvarying vec2 texCoord;\n\nvoid main(void) {\n    gl_Position = vec4(position, 0.0, 1.0);\n    texCoord = coord;\n}\n"},function(t,e){t.exports="precision mediump float;\n// uniform vec3 keyColor;\n// uniform sampler2D texture0;\n// varying vec2 texCoord;\n\n// void main() {\n//     vec4 color = texture2D(texture0, texCoord);\n    // float enabled = float(color.rgb != keyColor.rgb && color.a != 0.0);\n//     // gl_FragColor = vec4(color.rgb, color.a);\n//     gl_FragColor = color;\n// }\n\nuniform vec3 keyColor;\nuniform sampler2D texture0;\nuniform float threshold;\nvarying vec2 texCoord;\n\nvoid main(void) {\n    vec4 color = texture2D(texture0, texCoord);\n    float diff = length(keyColor - color.rgb);\n\n    if (diff < threshold) {\n        discard;\n    } else {\n        gl_FragColor = color;\n    }\n}\n"}]);